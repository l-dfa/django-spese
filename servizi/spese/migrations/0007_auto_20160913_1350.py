# -*- coding: utf-8 -*-
# Generated by Django 1.9.8 on 2016-09-13 11:50

from __future__ import unicode_literals
from django.db import migrations

from django.contrib.auth.models import User
from django.contrib.auth.models import User
from taggit.models import Tag

# python debugging
import pdb

def add_users(apps, schema_editor):
    user1 = User.objects.create_user('user1', 'user1@demospese.com', 'user1password')
    user2 = User.objects.create_user('user2', 'user2@demospese.com', 'user2password')
    user1.last_name = 'the first'
    user1.first_name = 'user'
    user1.save()
    user2.last_name = 'the second'
    user2.first_name = 'user'
    user2.save()
    
def add_tags(apps, schema_editor):
    tag = Tag.objects.create(name="transfer_funds", slug="transfer funds")
    tag.save()
        
def add_sources(apps, schema_editor):
    Source = apps.get_model("spese", "Source")
    source = Source.objects.create(name="cache")
    source.save()
    ### TRACE ###    pdb.set_trace()
    user = User.objects.get(pk=1)
    source.users.add(user.pk)    # thanks to http://stackoverflow.com/questions/29579871/django-data-migration-raising-a-type-error
    source.save()
    user = User.objects.get(pk=2)
    source.users.add(user.pk)
    source.save()
        
class Migration(migrations.Migration):

    dependencies = [
        ('spese', '0006_source_users'),
    ]

    operations = [
        migrations.RunPython(add_users),
        migrations.RunPython(add_tags),
        migrations.RunPython(add_sources),
    ]
